<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Cek Email | Ngebel Platform</title>
<meta name="theme-color" content="#0f766e">

<!-- Import Supabase Client dari CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
    --primary: #0f766e; --primary-light: #14b8a6;
    --bg-body: #f0f4f8;
    --glass: rgba(255, 255, 255, 0.95);
    --radius-xl: 32px; --radius-lg: 24px;
    --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.1);
}
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }

body {
    background: var(--bg-body); color: #1e293b;
    display: flex; align-items: center; justify-content: center;
    min-height: 100vh; padding: 20px; position: relative;
}

.auth-card {
    background: var(--glass); padding: 40px; border-radius: var(--radius-xl);
    width: 100%; max-width: 450px;
    box-shadow: var(--shadow-soft);
    text-align: center;
    backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.5);
    position: relative; z-index: 5;
    animation: fadeInUp 0.6s ease-out;
}

h2 { color: var(--primary); margin-bottom: 10px; font-family: 'Outfit', sans-serif; font-size: 1.8rem; }
p { color: #64748b; margin-bottom: 30px; font-size: 0.95rem; line-height: 1.5; }

.btn {
    width: 100%; padding: 16px; background: var(--primary);
    color: white; border: none; border-radius: 12px;
    font-weight: 700; font-size: 1rem; cursor: pointer;
    transition: transform 0.2s; margin-top: 10px;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    font-family: inherit; text-decoration: none;
}
.btn:disabled { background: #cbd5e1; cursor: not-allowed; }

.btn-outline {
    background: transparent; border: 2px solid var(--primary);
    color: var(--primary); margin-top: 15px;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    text-decoration: none; border-radius: 12px; padding: 14px;
    font-weight: 700;
}
.btn-outline:hover { background: rgba(15,118,110,0.05); }

.spinner {
    display: none; width: 20px; height: 20px;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 50%; border-top-color: white;
    animation: spin 1s linear infinite; margin: 0 auto;
}

@keyframes spin { 100% { transform: rotate(360deg); } }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

a { text-decoration: none; }
a:hover { text-decoration: underline; }
</style>
</head>
<body>

<div class="auth-card">
    <div style="font-size: 3.5rem; margin-bottom: 10px;">ðŸ“§</div>
    <h2>Cek Email Anda</h2>
    <p>
        Kami telah mengirimkan tautan konfirmasi ke alamat email Anda.<br>
        Silakan buka email untuk mengaktifkan akun Ngebel Anda.<br>
        Jika tidak melihat email dalam 1-2 menit, cek folder <strong>Spam</strong> atau <strong>Junk</strong>.
    </p>

    <button class="btn" id="btn-activation" disabled>
        <span class="btn-text">Sudah Aktivasi, Masuk</span>
        <div class="spinner"></div>
    </button>

    <a href="#" id="resend-email" class="btn-outline">Kirim Ulang Email</a>
    <a href="register.html" class="btn-outline">Salah alamat email? Daftar ulang</a>
</div>

<script>
// Supabase setup (gunakan akunmu sendiri)
const SUPABASE_URL = 'https://dikapquhusbwjccbqcsb.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';
const { createClient } = supabase;
const sb = createClient(SUPABASE_URL, SUPABASE_KEY);

// Tombol Masuk, aktif jika user sudah verifikasi
const btnActivation = document.getElementById("btn-activation");

// Contoh pengecekan status verifikasi email (async)
async function checkEmailVerified() {
    try {
        const { data, error } = await sb.auth.getUser();
        if (error) throw error;

        if (data.user?.email_confirmed_at) {
            btnActivation.disabled = false;
        } else {
            btnActivation.disabled = true;
        }
    } catch(err) {
        console.error("Cek verifikasi email error:", err);
    }
}

// Panggil setiap 5 detik untuk auto enable tombol jika sudah aktivasi
setInterval(checkEmailVerified, 5000);

// Klik tombol â€œSudah Aktivasi, Masukâ€ redirect ke login
btnActivation.addEventListener('click', () => {
    window.location.href = 'login.html';
});

// Kirim ulang email
document.getElementById("resend-email").addEventListener('click', async (e) => {
    e.preventDefault();
    try {
        const { data, error } = await sb.auth.resendConfirmationEmail();
        if (error) throw error;
        alert("Email konfirmasi telah dikirim ulang.");
    } catch(err) {
        console.error(err);
        alert("Gagal mengirim ulang email: " + err.message);
    }
});
</script>

</body>
</html>
