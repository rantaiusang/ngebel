<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<title>Tirta Husada | Smart Map PRO</title>
<meta name="theme-color" content="#0f766e" />
<meta name="description" content="Smart Map Interaktif Tirta Husada Ngebel" />

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-sA+4wH1zN3Qf3o0bM8qH7s5Qv3l9Y2z1u1pqt1r0X2M=" crossorigin=""/>

<!-- Fonts (Menggunakan font yang sama dengan referensi: Plus Jakarta Sans & Outfit) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* --- VARIABLES --- */
:root {
  --primary: #0f766e; --primary-light: #14b8a6; --primary-dark: #0d5e57;
  --accent: #f59e0b;
  --bg: #f1f5f9; --text: #1e293b; --text-muted: #64748b;
  --white: #ffffff;
  --glass: rgba(255, 255, 255, 0.85);
  --r-xl: 24px; --r-lg: 16px; --r-md: 12px;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --header-height: 70px;
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { 
  font-family: 'Plus Jakarta Sans', sans-serif; 
  background: var(--bg); color: var(--text); 
  padding-bottom: 40px; overflow-x: hidden; 
  -webkit-font-smoothing: antialiased;
}

h1, h2, h3, .brand-text { font-family: 'Outfit', sans-serif; letter-spacing: -0.02em; }

/* --- PRELOADER (Sesuai Referensi) --- */
#preloader {
  position: fixed; inset: 0; background: #ffffff; z-index: 9999; 
  display: flex; justify-content: center; align-items: center; flex-direction: column;
  transition: opacity 0.6s ease-in-out, visibility 0.6s;
}
.loader-content { text-align: center; }
.brand-logo-loader {
  font-family: 'Outfit', sans-serif; font-weight: 800; font-size: 2rem;
  color: var(--primary); margin-bottom: 24px; letter-spacing: -1px;
  animation: fadeInUp 0.8s ease-out;
}
.modern-spinner {
  width: 50px; height: 50px;
  border: 4px solid rgba(15, 118, 110, 0.1);
  border-left-color: var(--primary); border-radius: 50%;
  animation: spin 1s linear infinite; position: relative;
}
.modern-spinner::after {
  content: ""; position: absolute; top: 6px; left: 6px; right: 6px; bottom: 6px;
  border: 3px solid transparent; border-top-color: var(--accent);
  border-radius: 50%; animation: spin 0.8s linear infinite reverse;
}

@keyframes spin { to { transform: rotate(360deg); } }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* --- HEADER --- */
header {
  position: sticky; top: 0; z-index: 1000; height: var(--header-height);
  background: var(--glass); backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(0,0,0,0.05);
  display: flex; align-items: center; padding: 0 20px;
}

.back {
  padding: 8px 16px; border-radius: 99px; border: 1px solid rgba(0,0,0,0.08);
  background: var(--white); color: var(--text); font-weight: 600; font-size: 14px;
  display: flex; align-items: center; gap: 8px; cursor: pointer;
  transition: all 0.2s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
.back:active { transform: scale(0.96); }
.back:hover { background: var(--primary); color: #fff; border-color: var(--primary); }
.back svg { width: 18px; height: 18px; stroke-width: 2.5; }

/* --- CONTAINER --- */
.container { max-width: 600px; margin: 0 auto; padding: 0; }

/* --- MAP SECTION --- */
.map-section { position: relative; margin-top: 16px; margin-bottom: 80px; }
.map-wrap {
  position: relative; width: 100%; height: 60vh; min-height: 400px;
  border-radius: var(--r-xl); overflow: hidden;
  box-shadow: var(--shadow); z-index: 1; background: #e2e8f0;
}
#map { width: 100%; height: 100%; }

/* Overlay Info di atas Peta */
.overlay {
  position: absolute; left: 16px; right: 16px; bottom: 16px;
  background: var(--glass); backdrop-filter: blur(8px);
  padding: 12px 16px; border-radius: var(--r-lg);
  display: flex; justify-content: space-between; align-items: center;
  border: 1px solid rgba(255,255,255,0.4);
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  z-index: 5;
}
.loc-info h4 { font-size: 15px; color: var(--primary-dark); margin-bottom: 2px; }
.loc-info p { font-size: 12px; color: var(--text-muted); }
.pulse-dot {
  width: 12px; height: 12px; background: #22c55e; border-radius: 50%;
  box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
  animation: pulse-green 2s infinite;
}
@keyframes pulse-green {
  0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
  70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
  100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
}

/* --- ACTIONS GRID --- */
.grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
  padding: 0 16px; margin-bottom: 24px;
}
.card {
  background: var(--white); border-radius: var(--r-lg); padding: 16px;
  box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.03);
  display: flex; flex-direction: column; justify-content: space-between;
}
.card h3 { font-size: 15px; margin-bottom: 6px; color: var(--text); font-family: 'Outfit', sans-serif; }
.card p { font-size: 12px; color: var(--text-muted); line-height: 1.4; margin-bottom: 12px; }

.btn {
  width: 100%; padding: 10px; border-radius: 8px; border: none;
  font-weight: 600; font-size: 13px; cursor: pointer; transition: opacity 0.2s;
}
.btn:active { opacity: 0.8; }
.btn-primary { background: var(--primary); color: #fff; }
.btn-outline { background: transparent; border: 2px solid var(--accent); color: var(--accent); }

/* --- LAYERS CONTROL --- */
.layers-wrapper { padding: 0 16px; }
.layers-title { font-size: 14px; font-weight: 700; color: var(--text-muted); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }

.layer {
  background: var(--white); margin-bottom: 8px;
  border-radius: var(--r-md); padding: 12px 16px;
  display: flex; justify-content: space-between; align-items: center;
  cursor: pointer; transition: background 0.2s; border: 1px solid transparent;
}
.layer:active { background: #f1f5f9; }
.layer span { font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 10px; }

/* Custom Checkbox */
input[type="checkbox"] {
  appearance: none; width: 20px; height: 20px;
  border: 2px solid #cbd5e1; border-radius: 6px;
  background: #fff; cursor: pointer; position: relative;
  transition: all 0.2s;
}
input[type="checkbox"]:checked { background: var(--primary); border-color: var(--primary); }
input[type="checkbox"]:checked::after {
  content: '‚úì'; position: absolute; color: #fff;
  font-size: 14px; top: 50%; left: 50%; transform: translate(-50%, -50%);
}
</style>
</head>

<body>

    <!-- PRELOADER (Sesuai Request) -->
    <div id="preloader">
        <div class="loader-content">
           
            <div class="modern-spinner"></div>
        </div>
    </div>

<header>
  <button class="back" onclick="history.back()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
    Kembali
  </button>
</header>

<main class="container">

  <!-- MAP SECTION -->
  <section class="map-section">
    <div class="map-wrap">
      <div id="map"></div>

      <!-- Overlay Atas Peta -->
      <div class="overlay">
        <div class="loc-info">
          <h4>Tirta Husada</h4>
          <p>Ngebel, Ponorogo, Jawa Timur</p>
        </div>
        <div class="pulse-dot"></div>
      </div>
    </div>
  </section>

  <!-- ACTIONS GRID -->
  <div class="grid">
    <div class="card">
      <div>
        <h3>üó∫Ô∏è Navigasi</h3>
        <p>Rute tercepat via Google Maps.</p>
      </div>
      <button class="btn btn-primary" onclick="openRoute()">Buka Maps</button>
    </div>
    <div class="card">
      <div>
        <h3>üìç Lokasi Saya</h3>
        <p>Deteksi posisi saat ini.</p>
      </div>
      <button class="btn btn-outline" onclick="locateMe()">Deteksi GPS</button>
    </div>
  </div>

  <!-- LAYERS CONTROL -->
  <div class="layers-wrapper">
    <div class="layers-title">Tampilan Peta</div>
    
    <div class="layer" onclick="toggleLayer('spot', this)">
      <span>üè• Area Tirta Husada</span>
      <input type="checkbox" checked readonly>
    </div>

    <div class="layer" onclick="toggleLayer('fasilitas', this)">
      <span>üöª Fasilitas Umum</span>
      <input type="checkbox" checked readonly>
    </div>

    <div class="layer" onclick="toggleLayer('user', this)">
      <span>üö∂ Posisi Saya</span>
      <input type="checkbox" id="userCheck" readonly>
    </div>
  </div>

</main>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-o9N1j7kGStpP4Y1Y7r8X4qfZ0pniS3pSDOMkMt2rt7A=" crossorigin=""></script>

<script>
/* =========================
   KONFIGURASI & LOADING LOGIC
========================= */
const tirthusada = [-7.7912, 111.7465];
let map, spotLayer, fasilitasLayer, userLayer;

// Fungsi untuk menutup preloader
function closePreloader() {
    const preloader = document.getElementById('preloader');
    if (preloader) {
        preloader.style.opacity = '0';
        preloader.style.visibility = 'hidden'; // Mencegah klik setelah hilang
        setTimeout(() => {
            preloader.remove();
        }, 600); // Sesuaikan dengan durasi transition CSS
    }
}

// Event Listener saat halaman sepenuhnya dimuat
window.addEventListener('load', () => {
    // Beri sedikit delay agar user melihat animasi loading (UX)
    setTimeout(() => {
        closePreloader();
    }, 1500); // 1.5 detik
});

/* =========================
   CUSTOM ICON
========================= */
const createIcon = (color) => L.divIcon({
  className: 'custom-pin',
  html: `<div style="background-color: ${color}; width: 24px; height: 24px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); border: 3px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.3);"></div>`,
  iconSize: [24, 24],
  iconAnchor: [12, 24],
  popupAnchor: [0, -24]
});

/* =========================
   INIT MAP
========================= */
function initMap() {
  map = L.map('map', {
    center: tirthusada,
    zoom: 16,
    zoomControl: false 
  });

  L.control.zoom({ position: 'bottomright' }).addTo(map);

  // Tile Layer Carto Voyager (Lebih bersih & modern)
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OSM & CARTO',
    subdomains: 'abcd',
    maxZoom: 19
  }).addTo(map);

  /* =========================
     LAYERS & MARKERS
  ========================= */
  spotLayer = L.layerGroup().addTo(map);
  fasilitasLayer = L.layerGroup().addTo(map);
  userLayer = L.layerGroup(); 

  // Marker Utama
  L.marker(tirthusada, {icon: createIcon('#0f766e')})
    .bindPopup("<b>Tirta Husada</b><br>Lokasi Utama")
    .addTo(spotLayer);

  // Marker Fasilitas
  L.marker([-7.7915, 111.7461], {icon: createIcon('#f59e0b')}).bindPopup("Area Parkir").addTo(fasilitasLayer);
  L.marker([-7.7908, 111.7470], {icon: createIcon('#f59e0b')}).bindPopup("Toilet Umum").addTo(fasilitasLayer);
  L.marker([-7.7910, 111.7468], {icon: createIcon('#f59e0b')}).bindPopup("Mushola").addTo(fasilitasLayer);
}

// Jalankan Init
initMap();

/* =========================
   GPS USER
========================= */
function locateMe() {
  const btn = document.querySelector('.btn-outline');
  const originalText = btn.innerText;
  btn.innerText = "Mendeteksi...";
  btn.disabled = true;

  if (!navigator.geolocation) {
    alert("Browser Anda tidak mendukung Geolocation.");
    btn.innerText = originalText;
    btn.disabled = false;
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const latlng = [pos.coords.latitude, pos.coords.longitude];
      
      userLayer.clearLayers();
      L.marker(latlng, {icon: createIcon('#3b82f6')})
        .bindPopup("Lokasi Anda Saat Ini")
        .addTo(userLayer);
      
      if (!map.hasLayer(userLayer)) {
        map.addLayer(userLayer);
        document.getElementById('userCheck').checked = true;
      }

      map.flyTo(latlng, 17, { duration: 1.5 });
      
      btn.innerText = "Berhasil!";
      setTimeout(() => { 
        btn.innerText = originalText; 
        btn.disabled = false; 
      }, 2000);
    },
    (err) => {
      console.error(err);
      alert("Gagal mendapatkan lokasi. Pastikan GPS aktif.");
      btn.innerText = originalText;
      btn.disabled = false;
    },
    { enableHighAccuracy: true }
  );
}

/* =========================
   NAVIGASI
========================= */
function openRoute() {
  const dest = tirthusada[0] + ',' + tirthusada[1];
  window.open(`https://www.google.com/maps/dir/?api=1&destination=${dest}`, "_blank");
}

/* =========================
   TOGGLE LAYER
========================= */
function toggleLayer(id, element) {
  const checkbox = element.querySelector('input[type="checkbox"]');
  
  if (id === 'user') {
    if (!map.hasLayer(userLayer)) {
       if(userLayer.getLayers().length === 0) {
         locateMe();
         return;
       }
       map.addLayer(userLayer);
       checkbox.checked = true;
    } else {
      map.removeLayer(userLayer);
      checkbox.checked = false;
    }
  } else {
    const targetLayer = id === 'spot' ? spotLayer : fasilitasLayer;
    if (map.hasLayer(targetLayer)) {
      map.removeLayer(targetLayer);
      checkbox.checked = false;
    } else {
      map.addLayer(targetLayer);
      checkbox.checked = true;
    }
  }
}
</script>

</body>
</html>
